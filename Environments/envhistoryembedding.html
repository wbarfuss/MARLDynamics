<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.475">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="description" content="Embed an environment into a more complex representation of state/observation-action histories">

<title>MARLDynamics - History Embedding</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


<link rel="stylesheet" href="../styles.css">
<meta property="og:title" content="MARLDynamics - History Embedding">
<meta property="og:description" content="Embed an environment into a more complex representation of state/observation-action histories">
<meta property="og:site-name" content="MARLDynamics">
<meta name="twitter:title" content="MARLDynamics - History Embedding">
<meta name="twitter:description" content="Embed an environment into a more complex representation of state/observation-action histories">
<meta name="twitter:card" content="summary">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">MARLDynamics</span>
    </a>
  </div>
          <div id="quarto-search" class="" title="Search"></div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title">History Embedding</h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">MARLDynamics</a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">Agents</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Agents/astrategyactorcritic.html" class="sidebar-item-text sidebar-link">Strategy Actor-Critic</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Agents/astrategysarsa.html" class="sidebar-item-text sidebar-link">Strategy SARSA</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Agents/astrategybase.html" class="sidebar-item-text sidebar-link">Strategy Base</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Agents/abase.html" class="sidebar-item-text sidebar-link">Base</a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">Environments</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Environments/envbase.html" class="sidebar-item-text sidebar-link">Environment Base</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Environments/envhistoryembedding.html" class="sidebar-item-text sidebar-link active">History Embedding</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Environments/envsocialdilemma.html" class="sidebar-item-text sidebar-link">Social Dilemma</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Environments/envecologicalpublicgood.html" class="sidebar-item-text sidebar-link">Ecological Public Good</a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">Utilities</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Utilities/uflowplot.html" class="sidebar-item-text sidebar-link">FlowPlot</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Utilities/uhelpers.html" class="sidebar-item-text sidebar-link">Helpers</a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#examples" id="toc-examples" class="nav-link active" data-scroll-target="#examples">Examples</a>
  <ul class="collapse">
  <li><a href="#memory-1-prisoners-dilemma" id="toc-memory-1-prisoners-dilemma" class="nav-link" data-scroll-target="#memory-1-prisoners-dilemma">Memory-1 Prisoner’s Dilemma</a></li>
  <li><a href="#memory-1-ecological-public-good" id="toc-memory-1-ecological-public-good" class="nav-link" data-scroll-target="#memory-1-ecological-public-good">Memory-1 Ecological Public Good</a></li>
  </ul></li>
  <li><a href="#api" id="toc-api" class="nav-link" data-scroll-target="#api">API</a>
  <ul class="collapse">
  <li><a href="#histories" id="toc-histories" class="nav-link" data-scroll-target="#histories">Histories</a>
  <ul class="collapse">
  <li><a href="#get_all_histories" id="toc-get_all_histories" class="nav-link" data-scroll-target="#get_all_histories">_get_all_histories</a></li>
  <li><a href="#hist_contains_notpossibletrans" id="toc-hist_contains_notpossibletrans" class="nav-link" data-scroll-target="#hist_contains_notpossibletrans">_hist_contains_NotPossibleTrans</a></li>
  <li><a href="#stateacthistsix" id="toc-stateacthistsix" class="nav-link" data-scroll-target="#stateacthistsix">StateActHistsIx</a></li>
  <li><a href="#hsset" id="toc-hsset" class="nav-link" data-scroll-target="#hsset">hSset</a></li>
  </ul></li>
  <li><a href="#transitions-tensor" id="toc-transitions-tensor" class="nav-link" data-scroll-target="#transitions-tensor">Transitions tensor</a>
  <ul class="collapse">
  <li><a href="#histsja_transitiontensor" id="toc-histsja_transitiontensor" class="nav-link" data-scroll-target="#histsja_transitiontensor">histSjA_TransitionTensor</a></li>
  </ul></li>
  <li><a href="#reward-tensor" id="toc-reward-tensor" class="nav-link" data-scroll-target="#reward-tensor">Reward tensor</a>
  <ul class="collapse">
  <li><a href="#histsja_rewardtensor" id="toc-histsja_rewardtensor" class="nav-link" data-scroll-target="#histsja_rewardtensor">histSjA_RewardTensor</a></li>
  </ul></li>
  <li><a href="#partial-observation-and-environmental-uncertainty" id="toc-partial-observation-and-environmental-uncertainty" class="nav-link" data-scroll-target="#partial-observation-and-environmental-uncertainty">Partial observation and environmental uncertainty</a>
  <ul class="collapse">
  <li><a href="#obsacthistsix" id="toc-obsacthistsix" class="nav-link" data-scroll-target="#obsacthistsix">ObsActHistsIx</a></li>
  <li><a href="#hoset" id="toc-hoset" class="nav-link" data-scroll-target="#hoset">hOset</a></li>
  <li><a href="#histsja_observationtensor" id="toc-histsja_observationtensor" class="nav-link" data-scroll-target="#histsja_observationtensor">histSjA_ObservationTensor</a></li>
  </ul></li>
  <li><a href="#environment-wrapper" id="toc-environment-wrapper" class="nav-link" data-scroll-target="#environment-wrapper">Environment wrapper</a>
  <ul class="collapse">
  <li><a href="#historyembedded" id="toc-historyembedded" class="nav-link" data-scroll-target="#historyembedded">HistoryEmbedded</a></li>
  </ul></li>
  </ul></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/wbarfuss/MARLDynamics/issues/new" class="toc-action">Report an issue</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title d-none d-lg-block">History Embedding</h1>
</div>

<div>
  <div class="description">
    Embed an environment into a more complex representation of state/observation-action histories
  </div>
</div>


<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<!-- WARNING: THIS FILE WAS AUTOGENERATED! DO NOT EDIT! -->
<section id="examples" class="level1">
<h1>Examples</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> MARLDynamics.Environments.SocialDilemma <span class="im">import</span> SocialDilemma</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> MARLDynamics.Environments.EcologicalPublicGood <span class="im">import</span> EcologicalPublicGood</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> MARLDynamics.Agents.StrategyActorCritic <span class="im">import</span> stratAC</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> MARLDynamics.Utils <span class="im">import</span> FlowPlot <span class="im">as</span> fp</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> MARLDynamics.Environments.HistoryEmbedding <span class="im">import</span> HistoryEmbedded</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>socdi <span class="op">=</span> SocialDilemma(R<span class="op">=</span><span class="fl">1.0</span>, T<span class="op">=</span><span class="fl">1.2</span>, S<span class="op">=-</span><span class="fl">0.5</span>, P<span class="op">=</span><span class="fl">0.0</span>)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>ecopg <span class="op">=</span> EcologicalPublicGood(N<span class="op">=</span><span class="dv">2</span>, f<span class="op">=</span><span class="fl">1.2</span>, c<span class="op">=</span><span class="dv">5</span>, m<span class="op">=-</span><span class="dv">5</span>, qc<span class="op">=</span><span class="fl">0.2</span>, qr<span class="op">=</span><span class="fl">0.1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="memory-1-prisoners-dilemma" class="level2">
<h2 class="anchored" data-anchor-id="memory-1-prisoners-dilemma">Memory-1 Prisoner’s Dilemma</h2>
<p>With <em>history embedding</em>, we can wrap the standard normal form social dilemma envrionment into one, where the agents condition their action on the actions of the last rounds</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>memo1pd <span class="op">=</span> HistoryEmbedded(socdi, h<span class="op">=</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>which has effectively a state set with the four elements</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>memo1pd.Sset</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>['c,c,.|', 'c,d,.|', 'd,c,.|', 'd,d,.|']</code></pre>
</div>
</div>
<p>As you can see in the flow plots, this opens the possiblity for cooperation:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>mae1 <span class="op">=</span> stratAC(env<span class="op">=</span>memo1pd, learning_rates<span class="op">=</span><span class="fl">0.1</span>, discount_factors<span class="op">=</span><span class="fl">0.9</span>)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> ([<span class="dv">0</span>], [<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>], [<span class="dv">0</span>])</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> ([<span class="dv">1</span>], [<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>], [<span class="dv">0</span>])</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> fp.plot_strategy_flow(mae1, x, y, flowarrow_points<span class="op">=</span>np.linspace(<span class="fl">0.01</span> ,<span class="fl">0.99</span>, <span class="dv">9</span>), NrRandom<span class="op">=</span><span class="dv">32</span>,</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>                           conds<span class="op">=</span>mae1.env.Sset)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="01_EnvHistoryEmbedding_files/figure-html/cell-7-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>In contrast to the case where agents do not react to the actions of the past round. Here, the only strategy the agents learn is defection:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>mae0 <span class="op">=</span> stratAC(env<span class="op">=</span>socdi, learning_rates<span class="op">=</span><span class="fl">0.1</span>, discount_factors<span class="op">=</span><span class="fl">0.9</span>)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> ([<span class="dv">0</span>], [<span class="dv">0</span>], [<span class="dv">0</span>])</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> ([<span class="dv">1</span>], [<span class="dv">0</span>], [<span class="dv">0</span>])</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> fp.plot_strategy_flow(mae0, x, y, flowarrow_points<span class="op">=</span>np.linspace(<span class="fl">0.01</span> ,<span class="fl">0.99</span>, <span class="dv">9</span>), NrRandom<span class="op">=</span><span class="dv">32</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="01_EnvHistoryEmbedding_files/figure-html/cell-8-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>What is the effect of having longer action histories?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>hlen <span class="op">=</span> <span class="dv">2</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>memoXpd <span class="op">=</span> HistoryEmbedded(socdi, h<span class="op">=</span>(<span class="dv">1</span>, hlen, hlen))</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>( <span class="bu">len</span>(memoXpd.Sset) )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>16</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>maeX <span class="op">=</span> stratAC(env<span class="op">=</span>memoXpd, learning_rates<span class="op">=</span><span class="fl">0.1</span>, discount_factors<span class="op">=</span><span class="fl">0.9</span>)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>,<span class="dv">1</span>, figsize<span class="op">=</span>(<span class="dv">8</span>,<span class="dv">9</span>))</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>faps <span class="op">=</span> np.linspace(<span class="fl">0.01</span> ,<span class="fl">0.99</span>, <span class="dv">13</span>)</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> ([<span class="dv">0</span>], [<span class="dv">0</span>], [<span class="dv">0</span>])</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> ([<span class="dv">1</span>], [<span class="dv">0</span>], [<span class="dv">0</span>])</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>fp.plot_strategy_flow(mae1, x, y, flowarrow_points<span class="op">=</span>faps, NrRandom<span class="op">=</span><span class="dv">32</span>, cmap<span class="op">=</span><span class="st">"Blues"</span>, axes<span class="op">=</span>[ax])</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>fp.plot_strategy_flow(maeX, x, y, flowarrow_points<span class="op">=</span>faps, NrRandom<span class="op">=</span><span class="dv">32</span>, cmap<span class="op">=</span><span class="st">"Reds"</span>, axes<span class="op">=</span>[ax])<span class="op">;</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">"Agent 0's cooperation probability"</span>)</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">"Agent 1's cooperation probability"</span>)</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">"Full cooperation in past rounds"</span>)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="01_EnvHistoryEmbedding_files/figure-html/cell-10-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>The longer action histories give additional force to mutual cooperation when the agents have cooperated in the past rounds and are close to cooperation. This suggests the hypothesis that longer action histories are beneficial for cooperation to be learned. However, more simulation would be needed to answer this question.</p>
</section>
<section id="memory-1-ecological-public-good" class="level2">
<h2 class="anchored" data-anchor-id="memory-1-ecological-public-good">Memory-1 Ecological Public Good</h2>
<p>What is the effect of condition actions also on the past actions in the ecological public goods envrionment?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>ecopg1 <span class="op">=</span> HistoryEmbedded(ecopg, h<span class="op">=</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>))</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>ecopg1.Sset</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>['c,c,g|',
 'c,c,p|',
 'c,d,g|',
 'c,d,p|',
 'd,c,g|',
 'd,c,p|',
 'd,d,g|',
 'd,d,p|']</code></pre>
</div>
</div>
<p>Visualizing the flow of learning in the prosperous state:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>mae1 <span class="op">=</span> stratAC(env<span class="op">=</span>ecopg1, learning_rates<span class="op">=</span><span class="fl">0.1</span>, discount_factors<span class="op">=</span><span class="fl">0.9</span>)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> ([<span class="dv">0</span>], [<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">5</span>,<span class="dv">7</span>], [<span class="dv">0</span>])</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> ([<span class="dv">1</span>], [<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">5</span>,<span class="dv">7</span>], [<span class="dv">0</span>])</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> fp.plot_strategy_flow(mae1, x, y, flowarrow_points<span class="op">=</span>np.linspace(<span class="fl">0.01</span> ,<span class="fl">0.99</span>, <span class="dv">9</span>), NrRandom<span class="op">=</span><span class="dv">32</span>,</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>                           conds<span class="op">=</span>np.array(mae1.env.Sset)[[<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">5</span>,<span class="dv">7</span>]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="01_EnvHistoryEmbedding_files/figure-html/cell-12-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>This flow has similarites to the flow of the memory-1 Prisoner’s Dilemma above, yet with more tendency toward cooperation. This is expected, since the ecological public good without memory-1 has also more tendency towards cooperation.</p>
</section>
</section>
<section id="api" class="level1">
<h1>API</h1>
<section id="histories" class="level2">
<h2 class="anchored" data-anchor-id="histories">Histories</h2>
<p>A history specification determines which realizations of the past the agents will conditions their actions on.</p>
<p>A history specification <code>h</code> is an iterable of length 1+<code>N</code>. The first value indicates how many time steps of the state observation the agents will use to conditions their actions on. The remaining values indicate how many actions of each agent are used.</p>
<hr>
<p><a href="https://github.com/wbarfuss/MARLDynamics/blob/main/MARLDynamics/Environments/HistoryEmbedding.py#L16" target="_blank" style="float:right; font-size:smaller">source</a></p>
<section id="get_all_histories" class="level3">
<h3 class="anchored" data-anchor-id="get_all_histories">_get_all_histories</h3>
<blockquote class="blockquote">
<pre><code> _get_all_histories (env, h, attr='Z')</code></pre>
</blockquote>
<table class="table">
<thead>
<tr class="header">
<th></th>
<th><strong>Type</strong></th>
<th><strong>Default</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>env</td>
<td></td>
<td></td>
<td>An environment</td>
</tr>
<tr class="even">
<td>h</td>
<td></td>
<td></td>
<td>A history specification</td>
</tr>
<tr class="odd">
<td>attr</td>
<td>str</td>
<td>Z</td>
<td></td>
</tr>
</tbody>
</table>
<p>The <em>default</em> history specification is <code>h=(1,0,0)</code>. Each agent observes information about the previous state, but none about the other agents.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>_get_all_histories(socdi, h<span class="op">=</span>(<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>[('.', '.', 0)]</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>_get_all_histories(ecopg, h<span class="op">=</span>(<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>[('.', '.', 0), ('.', '.', 1)]</code></pre>
</div>
</div>
<p>Each element of these lists is one <em>history</em>. The <code>'.'</code> indicates a dummy value for the non-observable actions. As you can see, here, the actions come before the state information - in contrast to the history specification <code>h</code>. You can think of time traveling from left to right in each history. First the agents choose their joint action, than they observe some state information, after which they choose another joint action. And so on, and so forth.</p>
<p>For example, the often used <em>memory-one</em> social dilemmas can be obtained by</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>_get_all_histories(socdi, h<span class="op">=</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>[(0, 0, '.'), (0, 1, '.'), (1, 0, '.'), (1, 1, '.')]</code></pre>
</div>
</div>
<p>Here, the information about the environment is discarded, indicated by the <code>'.'</code>.</p>
<p>But the action-history lengths need not be identical,</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>_get_all_histories(socdi, h<span class="op">=</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>[('.', 0, '.', 0, 0, '.'),
 ('.', 0, '.', 0, 1, '.'),
 ('.', 0, '.', 1, 0, '.'),
 ('.', 0, '.', 1, 1, '.'),
 ('.', 1, '.', 0, 0, '.'),
 ('.', 1, '.', 0, 1, '.'),
 ('.', 1, '.', 1, 0, '.'),
 ('.', 1, '.', 1, 1, '.')]</code></pre>
</div>
</div>
<p>Here, each history contains six elements, since it spans two time steps, and each time step is represented by one element for each agent’s action plus one element for the environment.</p>
<p>Of course, histories can be obtained for any environment.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>_get_all_histories(ecopg, h<span class="op">=</span>(<span class="dv">2</span>,<span class="dv">1</span>,<span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>[('.', '.', 0, 0, 0, 0),
 ('.', '.', 0, 0, 0, 1),
 ('.', '.', 0, 0, 1, 0),
 ('.', '.', 0, 0, 1, 1),
 ('.', '.', 0, 1, 0, 0),
 ('.', '.', 0, 1, 0, 1),
 ('.', '.', 0, 1, 1, 0),
 ('.', '.', 0, 1, 1, 1),
 ('.', '.', 1, 0, 0, 0),
 ('.', '.', 1, 0, 0, 1),
 ('.', '.', 1, 0, 1, 0),
 ('.', '.', 1, 0, 1, 1),
 ('.', '.', 1, 1, 0, 0),
 ('.', '.', 1, 1, 0, 1),
 ('.', '.', 1, 1, 1, 0),
 ('.', '.', 1, 1, 1, 1)]</code></pre>
</div>
</div>
<p>With <a href="https://wbarfuss.github.io/MARLDynamics/Environments/envhistoryembedding.html#_get_all_histories"><code>_get_all_histories</code></a> we simply iterate through all state and action indicies. However, we are not checking whether a history is actually possible given the transition probabilities of the envrionment.</p>
<hr>
<p><a href="https://github.com/wbarfuss/MARLDynamics/blob/main/MARLDynamics/Environments/HistoryEmbedding.py#L47" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="hist_contains_notpossibletrans" class="level3">
<h3 class="anchored" data-anchor-id="hist_contains_notpossibletrans">_hist_contains_NotPossibleTrans</h3>
<blockquote class="blockquote">
<pre><code> _hist_contains_NotPossibleTrans (env, hist:Iterable)</code></pre>
</blockquote>
<p>Checks whether the history contains transitions which are not possible with the environment’s transition probabilities.</p>
<table class="table">
<thead>
<tr class="header">
<th></th>
<th><strong>Type</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>env</td>
<td></td>
<td>An environment</td>
</tr>
<tr class="even">
<td>hist</td>
<td>typing.Iterable</td>
<td>A history</td>
</tr>
<tr class="odd">
<td><strong>Returns</strong></td>
<td><strong>bool</strong></td>
<td><strong>History impossible?</strong></td>
</tr>
</tbody>
</table>
<p>For example, in the prosperous state <code>1</code> of the ecological public good, when both agents choose the cooperative action <code>0</code>, there is no chance to leave the propserous state and enter the degraded state <code>0</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>_hist_contains_NotPossibleTrans(ecopg, hist<span class="op">=</span>(<span class="st">'.'</span>, <span class="st">'.'</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>True</code></pre>
</div>
</div>
<p>Thus, any history that contains this transition is not needed.</p>
<p>Yet, if only one agent chooses the defective action <code>0</code>, a transition to the degraded state becomes possible and corresponding histories cannot be discarded.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>_hist_contains_NotPossibleTrans(ecopg, hist<span class="op">=</span>(<span class="st">'.'</span>, <span class="st">'.'</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>False</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>_hist_contains_NotPossibleTrans(ecopg, hist<span class="op">=</span>(<span class="st">'.'</span>, <span class="st">'.'</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>False</code></pre>
</div>
</div>
<hr>
<p><a href="https://github.com/wbarfuss/MARLDynamics/blob/main/MARLDynamics/Environments/HistoryEmbedding.py#L81" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="stateacthistsix" class="level3">
<h3 class="anchored" data-anchor-id="stateacthistsix">StateActHistsIx</h3>
<blockquote class="blockquote">
<pre><code> StateActHistsIx (env, h)</code></pre>
</blockquote>
<p>Returns all state-action histories (in indices) of <code>env</code>.</p>
<p><code>h</code> specifies the type of history. <code>h</code> must be an iterable of length 1+N (where N = Nr. of Agents) The first element of <code>h</code> specifies the length of the state-history Subsequent elements specify the length of the respective action-history</p>
<p>For example, the <em>memory-one</em> social dilemmas is obtained by</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>StateActHistsIx(socdi, h<span class="op">=</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>[(0, 0, '.'), (0, 1, '.'), (1, 0, '.'), (1, 1, '.')]</code></pre>
</div>
</div>
<p>which is identical to</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>_get_all_histories(socdi, h<span class="op">=</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>[(0, 0, '.'), (0, 1, '.'), (1, 0, '.'), (1, 1, '.')]</code></pre>
</div>
</div>
<p>since all histories are actually possible in the environment.</p>
<p>However, in our ecological public good example, this is not the case:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(StateActHistsIx(ecopg, h<span class="op">=</span>(<span class="dv">2</span>,<span class="dv">1</span>,<span class="dv">1</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>15</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="bu">len</span>(_get_all_histories(ecopg, h<span class="op">=</span>(<span class="dv">2</span>,<span class="dv">1</span>,<span class="dv">1</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>16</code></pre>
</div>
</div>
<p>Depending on the environment, filtering out impossible histories can lead to a significant performance boost.</p>
<hr>
<p><a href="https://github.com/wbarfuss/MARLDynamics/blob/main/MARLDynamics/Environments/HistoryEmbedding.py#L103" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="hsset" class="level3">
<h3 class="anchored" data-anchor-id="hsset">hSset</h3>
<blockquote class="blockquote">
<pre><code> hSset (env, h)</code></pre>
</blockquote>
<p>String representation of the histories.</p>
<table class="table">
<thead>
<tr class="header">
<th></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>env</td>
<td>An environment</td>
</tr>
<tr class="even">
<td>h</td>
<td>A history specificaiton</td>
</tr>
</tbody>
</table>
<p>For example,</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>hSset(socdi, h<span class="op">=</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>['c,c,.|', 'c,d,.|', 'd,c,.|', 'd,d,.|']</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>hSset(ecopg, h<span class="op">=</span>(<span class="dv">2</span>,<span class="dv">1</span>,<span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>[',,g|c,c,g|',
 ',,g|c,c,p|',
 ',,g|c,d,g|',
 ',,g|c,d,p|',
 ',,g|d,c,g|',
 ',,g|d,c,p|',
 ',,g|d,d,g|',
 ',,g|d,d,p|',
 ',,p|c,c,p|',
 ',,p|c,d,g|',
 ',,p|c,d,p|',
 ',,p|d,c,g|',
 ',,p|d,c,p|',
 ',,p|d,d,g|',
 ',,p|d,d,p|']</code></pre>
</div>
</div>
</section>
</section>
<section id="transitions-tensor" class="level2">
<h2 class="anchored" data-anchor-id="transitions-tensor">Transitions tensor</h2>
<hr>
<p><a href="https://github.com/wbarfuss/MARLDynamics/blob/main/MARLDynamics/Environments/HistoryEmbedding.py#L127" target="_blank" style="float:right; font-size:smaller">source</a></p>
<section id="histsja_transitiontensor" class="level3">
<h3 class="anchored" data-anchor-id="histsja_transitiontensor">histSjA_TransitionTensor</h3>
<blockquote class="blockquote">
<pre><code> histSjA_TransitionTensor (env, h)</code></pre>
</blockquote>
<p>Returns Transition Tensor of <code>env</code> with state-action history specification <code>h</code>.</p>
<p><code>h</code> must be an iterable of length 1+N (where N = Nr. of Agents) The first element of <code>h</code> specifies the length of the state-history Subsequent elements specify the length of the respective action-history</p>
<p>For example,</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>histSjA_TransitionTensor(socdi, h<span class="op">=</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">1</span>)).shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>(4, 2, 2, 4)</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>histSjA_TransitionTensor(ecopg, h<span class="op">=</span>(<span class="dv">2</span>,<span class="dv">1</span>,<span class="dv">1</span>)).shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>(15, 2, 2, 15)</code></pre>
</div>
</div>
</section>
</section>
<section id="reward-tensor" class="level2">
<h2 class="anchored" data-anchor-id="reward-tensor">Reward tensor</h2>
<hr>
<p><a href="https://github.com/wbarfuss/MARLDynamics/blob/main/MARLDynamics/Environments/HistoryEmbedding.py#L186" target="_blank" style="float:right; font-size:smaller">source</a></p>
<section id="histsja_rewardtensor" class="level3">
<h3 class="anchored" data-anchor-id="histsja_rewardtensor">histSjA_RewardTensor</h3>
<blockquote class="blockquote">
<pre><code> histSjA_RewardTensor (env, h)</code></pre>
</blockquote>
<p>Returns Reward Tensor of <code>env</code> with state-action history specification <code>h</code>.</p>
<p><code>h</code> must be an iterable of length 1+N (where N = Nr. of Agents) The first element of <code>h</code> specifies the length of the state-history Subsequent elements specify the length of the respective action-history</p>
<p>For example,</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>histSjA_RewardTensor(socdi, h<span class="op">=</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>)).shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>(2, 4, 2, 2, 4)</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>histSjA_RewardTensor(ecopg, h<span class="op">=</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>)).shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>(2, 8, 2, 2, 8)</code></pre>
</div>
</div>
</section>
</section>
<section id="partial-observation-and-environmental-uncertainty" class="level2">
<h2 class="anchored" data-anchor-id="partial-observation-and-environmental-uncertainty">Partial observation and environmental uncertainty</h2>
<p>Note: These elements are useful for enviroments with state uncertainty or likewise, partial observability. Such are not yet available in this respository.</p>
<hr>
<p><a href="https://github.com/wbarfuss/MARLDynamics/blob/main/MARLDynamics/Environments/HistoryEmbedding.py#L217" target="_blank" style="float:right; font-size:smaller">source</a></p>
<section id="obsacthistsix" class="level3">
<h3 class="anchored" data-anchor-id="obsacthistsix">ObsActHistsIx</h3>
<blockquote class="blockquote">
<pre><code> ObsActHistsIx (env, h)</code></pre>
</blockquote>
<p>Returns all obs-action histories of <code>env</code>.</p>
<p><code>h</code> specifies the type of history. <code>h</code> must be an iterable of length 1+N (where N = Nr. of Agents) The first element of <code>h</code> specifies the length of the obs-history Subsequent elements specify the length of the respective action-history</p>
<p>Note: Here only partial observability regarding the envrionmental state applies. Additional partial observability regarding action is treated seperatly.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>ObsActHistsIx(socdi, h<span class="op">=</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>[(0, 0, 0), (0, 1, 0), (1, 0, 0), (1, 1, 0)]</code></pre>
</div>
</div>
<hr>
<p><a href="https://github.com/wbarfuss/MARLDynamics/blob/main/MARLDynamics/Environments/HistoryEmbedding.py#L261" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="hoset" class="level3">
<h3 class="anchored" data-anchor-id="hoset">hOset</h3>
<blockquote class="blockquote">
<pre><code> hOset (env, h)</code></pre>
</blockquote>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>hOset(socdi, h<span class="op">=</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>[['c,c,.|', 'c,d,.|', 'd,c,.|', 'd,d,.|'],
 ['c,c,.|', 'c,d,.|', 'd,c,.|', 'd,d,.|']]</code></pre>
</div>
</div>
<hr>
<p><a href="https://github.com/wbarfuss/MARLDynamics/blob/main/MARLDynamics/Environments/HistoryEmbedding.py#L284" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="histsja_observationtensor" class="level3">
<h3 class="anchored" data-anchor-id="histsja_observationtensor">histSjA_ObservationTensor</h3>
<blockquote class="blockquote">
<pre><code> histSjA_ObservationTensor (env, h)</code></pre>
</blockquote>
<p>Returns Observation Tensor of <code>env</code> with state-action history <code>h</code>[iterable]</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>histSjA_ObservationTensor(socdi, h<span class="op">=</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>array([[[1., 0., 0., 0.],
        [0., 1., 0., 0.],
        [0., 0., 1., 0.],
        [0., 0., 0., 1.]],

       [[1., 0., 0., 0.],
        [0., 1., 0., 0.],
        [0., 0., 1., 0.],
        [0., 0., 0., 1.]]])</code></pre>
</div>
</div>
</section>
</section>
<section id="environment-wrapper" class="level2">
<h2 class="anchored" data-anchor-id="environment-wrapper">Environment wrapper</h2>
<hr>
<p><a href="https://github.com/wbarfuss/MARLDynamics/blob/main/MARLDynamics/Environments/HistoryEmbedding.py#L312" target="_blank" style="float:right; font-size:smaller">source</a></p>
<section id="historyembedded" class="level3">
<h3 class="anchored" data-anchor-id="historyembedded">HistoryEmbedded</h3>
<blockquote class="blockquote">
<pre><code> HistoryEmbedded (env, h)</code></pre>
</blockquote>
<p>Abstract Environment wrapper to embed a given environment into a larger history space</p>
<p><code>h</code> must be an iterable of length 1+N (where N=Nr. of Agents) The first element of <code>history</code> specifies the length of the state-history. Subsequent elements specify the length of the respective action-history</p>
<table class="table">
<thead>
<tr class="header">
<th></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>env</td>
<td>An environment</td>
</tr>
<tr class="even">
<td>h</td>
<td>History specification</td>
</tr>
</tbody>
</table>


</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>